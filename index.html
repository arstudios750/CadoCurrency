<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadocurrency Miner</title>
<style>
body {
  background: #0d0d0d;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 { margin-top: 20px; color: #ffcc00; text-shadow: 0 0 10px #ffcc00; }
#cadocurrencyDisplay { font-size: 2em; margin: 10px 0; }
#cpsDisplay { color: #ccc; font-size: 1em; margin-bottom: 20px; }
#mineButton {
  padding: 20px 50px;
  font-size: 22px;
  background: linear-gradient(45deg,#ffcc00,#ffaa00);
  border: none;
  border-radius: 15px;
  cursor: pointer;
  margin: 20px;
  transition: transform 0.1s, box-shadow 0.1s;
}
#mineButton:active { transform: scale(0.95); box-shadow: 0 0 20px #ffcc00 inset; }
.shop { margin: 20px auto; display: flex; justify-content: center; flex-wrap: wrap; }
.item { background: #222; border-radius: 15px; padding: 15px; margin: 10px; width: 200px; transition: transform 0.2s; }
.item:hover { transform: translateY(-5px); }
.item h3 { color: #00ccff; }
.item p { margin: 5px 0; }
button.buy { background: #00ccff; border: none; padding: 8px 15px; cursor: pointer; margin-top: 10px; border-radius: 8px; transition: transform 0.1s; }
button.buy:active { transform: scale(0.95); }
.floating { position: absolute; font-weight: bold; color: #ffcc00; animation: floatUp 1s forwards; }
@keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-50px) scale(1.3); } }
#transferSection { margin: 20px auto; }
#friendId, #transferAmount { padding: 5px; width: 100px; margin: 5px; border-radius:5px; border:none;}
#transferButton { padding:5px 10px; border-radius:5px; background:#ff66cc; border:none; cursor:pointer;}
</style>
</head>
<body>
<h1>Cadocurrency Miner</h1>
<div id="cadocurrencyDisplay">0 ₡</div>
<div id="cpsDisplay">CPS: 0 ₡/s</div>
<button id="mineButton">Mine Cadocurrency!</button>

<h2>Upgrades</h2>
<div class="shop" id="shop">
  <div class="item">
    <h3>Mining Rig</h3>
    <p>+1 ₡ per second</p>
    <p>Cost: <span class="price" data-price="50">50</span> ₡</p>
    <button class="buy" data-type="rig" data-cost="50">Buy</button>
  </div>
  <div class="item">
    <h3>Crypto Farm</h3>
    <p>+5 ₡ per second</p>
    <p>Cost: <span class="price" data-price="250">250</span> ₡</p>
    <button class="buy" data-type="farm" data-cost="250">Buy</button>
  </div>
  <div class="item">
    <h3>Quantum Miner</h3>
    <p>+20 ₡ per second</p>
    <p>Cost: <span class="price" data-price="1000">1000</span> ₡</p>
    <button class="buy" data-type="quantum" data-cost="1000">Buy</button>
  </div>
</div>

<h2>Transfer Cadocurrency</h2>
<div id="transferSection">
  Friend ID: <input type="text" id="friendId" placeholder="userId">
  Amount: <input type="number" id="transferAmount" placeholder="₡">
  <button id="transferButton">Send</button>
</div>

<script>
// ----- Config -----
const BIN_ID = "68fba81cd0ea881f40b8a124"; // your JSONBin bin ID
const API_KEY = "$2a$10$zpjslVaoxbKMJkKdRhdbo.Dca9uAcSHCLE.FXIzaIy6S4GipqvL.6"; // master key (client-side unsafe)
let currentUserId = "guest123"; // demo user

// ----- Miner State -----
let cadocurrency = 0;
let cps = 0;
let upgrades = {
  rig: {count: 0, cps: 1, cost: 50},
  farm: {count: 0, cps: 5, cost: 250},
  quantum: {count: 0, cps: 20, cost: 1000}
};

// ----- DOM Elements -----
const cadDisplay = document.getElementById('cadocurrencyDisplay');
const cpsDisplay = document.getElementById('cpsDisplay');
const mineButton = document.getElementById('mineButton');
const shopButtons = document.querySelectorAll('.buy');
const friendIdInput = document.getElementById('friendId');
const transferAmountInput = document.getElementById('transferAmount');
const transferButton = document.getElementById('transferButton');

// ----- Helpers -----
function updateDisplay() {
  cadDisplay.textContent = Math.floor(cadocurrency) + ' ₡';
  cpsDisplay.textContent = `CPS: ${cps} ₡/s`;
}

function floatText(x, y, text) {
  const span = document.createElement('span');
  span.textContent = text;
  span.className = 'floating';
  span.style.left = x + 'px';
  span.style.top = y + 'px';
  document.body.appendChild(span);
  setTimeout(() => document.body.removeChild(span), 1000);
}

// ----- JSONBin API -----
async function getBinData() {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
    headers: { "X-Master-Key": API_KEY }
  });
  const data = await res.json();
  return data.record;
}

async function updateBinData(newData) {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify(newData)
  });
}

// ----- Load / Save -----
async function loadUser() {
  const data = await getBinData();
  const user = data.users.find(u => u.userId === currentUserId);
  if (user) {
    cadocurrency = user.cadocurrency;
    for (let key in upgrades) {
      upgrades[key].count = user.upgrades[key].count;
      cps += upgrades[key].count * upgrades[key].cps;
      upgrades[key].cost = Math.floor((key==="rig"?50:key==="farm"?250:1000) * Math.pow(1.5, upgrades[key].count));
    }
    updateDisplay();
  }
}

async function saveUser() {
  const data = await getBinData();
  const user = data.users.find(u => u.userId === currentUserId);
  if (user) {
    user.cadocurrency = cadocurrency;
    for (let key in upgrades) user.upgrades[key].count = upgrades[key].count;
    user.lastUpdated = new Date().toISOString();
    await updateBinData(data);
  }
}

// ----- Mining -----
mineButton.addEventListener('click', (e) => {
  cadocurrency += 1;
  updateDisplay();
  floatText(e.clientX, e.clientY, '+1');
  saveUser();
});

// Passive CPS tick
setInterval(() => {
  cadocurrency += cps;
  updateDisplay();
  saveUser();
}, 1000);

// ----- Upgrades -----
shopButtons.forEach(button => {
  button.addEventListener('click', () => {
    const type = button.dataset.type;
    const upgrade = upgrades[type];
    if (cadocurrency >= upgrade.cost) {
      cadocurrency -= upgrade.cost;
      upgrade.count += 1;
      cps += upgrade.cps;
      upgrade.cost = Math.floor(upgrade.cost * 1.5);
      button.dataset.cost = upgrade.cost;
      button.previousElementSibling.textContent = `Cost: ${upgrade.cost} ₡`;
      updateDisplay();
      floatText(button.getBoundingClientRect().x + 50, button.getBoundingClientRect().y, `+${upgrade.cps}/s`);
      saveUser();
    }
  });
});

// ----- Transfer -----
transferButton.addEventListener('click', async () => {
  const receiverId = friendIdInput.value.trim();
  const amount = parseInt(transferAmountInput.value);
  if (!receiverId || isNaN(amount) || amount <= 0) {
    alert("Enter valid friend ID and amount!");
    return;
  }
  try {
    const data = await getBinData();
    const sender = data.users.find(u => u.userId === currentUserId);
    const receiver = data.users.find(u => u.userId === receiverId);
    if (!receiver) { alert("Friend not found"); return; }
    if (sender.cadocurrency < amount) { alert("Insufficient balance"); return; }

    sender.cadocurrency -= amount;
    receiver.cadocurrency += amount;
    sender.lastUpdated = receiver.lastUpdated = new Date().toISOString();
    await updateBinData(data);
    cadocurrency = sender.cadocurrency;
    updateDisplay();
    alert(`Transferred ${amount} ₡ to ${receiver.username}`);
  } catch (e) {
    console.error(e);
    alert("Transfer failed");
  }
});

// ----- Init -----
loadUser();
</script>
</body>
</html>
